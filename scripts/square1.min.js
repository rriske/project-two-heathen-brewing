/*
* Square1 Slider
* Copyright (c) 2016 Thom Hines
* Licensed under MIT.
* @author Thom Hines
* https://github.com/thomhines/square1
* @version 0.4.0
*/

(function(e){e.fn.square1=function(a){function t(a){var r=a.find("img");r.attr("data-src")&&!r.attr("src")&&r.show().attr("src",r.attr("data-src")).attr("srcset",r.attr("data-srcset"));var s=r.attr("src");if(r.attr("srcset")){if(!r.prop("currentSrc"))return void setTimeout(function(){t(a)},100);s=r.prop("currentSrc")}a.css("background-image","url("+s+")"),img=new Image,img.onload=function(){a.next().hasClass("image_wrapper")?u.lazy_load||t(a.next()):(p.attr("images_loaded","").removeClass("loading"),u.onLoad()),a.addClass("image_loaded")},img.src=s,img.complete&&img.onload(),r.hide(),e('.wrap_placeholder[background-image="'+s+'"]',p).css("background-image","url("+s+")")}function r(){c=1,i(),_(),u.onPlay()}function s(){clearInterval(c),u.onStop()}function i(){c&&(clearInterval(c),c=setInterval(n,u.slide_duration+u.transition_time),e(p).data("interval",c))}function n(){var a=e(".current_slide",p).index();a>=e(".image_wrapper",p).length-1?(C=1,d(0)):d(a+1)}function o(){var a=e(".current_slide",p).index();0==a?(C=1,d(e(".image_wrapper",p).last().index())):d(a-1)}function d(a){if(!e(".image_wrapper",p).eq(a).hasClass("image_loaded"))return t(e(".image_wrapper",p).eq(a)),void setTimeout(function(){d(a)},100);e(".image_wrapper",p).finish().clearQueue(),"slide"==u.animation?(reset_slide_position=!1,target_slide=a,last_slide=e(".image_wrapper",p).last().index(),clearTimeout(w),e(".image_wrapper, .wrap_placeholder",p).removeClass("no_transition"),C&&0==a?(reset_slide_position="first",target_slide=last_slide+1):C&&a==last_slide&&(reset_slide_position="last",target_slide=-1),C=0,e(".current_slide",p).removeClass("current_slide"),e(".image_wrapper",p).eq(a).addClass("current_slide"),translate_target=-100*target_slide,e(".image_wrapper, .wrap_placeholder",p).css("transform","translateX("+translate_target+"%)"),"first"==reset_slide_position&&(w=setTimeout(function(){e(".image_wrapper, .wrap_placeholder",p).addClass("no_transition"),e(".image_wrapper, .wrap_placeholder",p).css("transform","translateX(0%)")},u.transition_time)),"last"==reset_slide_position&&(w=setTimeout(function(){e(".image_wrapper, .wrap_placeholder",p).addClass("no_transition"),e(".image_wrapper, .wrap_placeholder",p).css("transform","translateX(-"+100*last_slide+"%)")},u.transition_time))):"cover"==u.fill_mode?a>e(".current_slide",p).index()?(e(".current_slide",p).removeClass("current_slide"),e(".image_wrapper",p).eq(a).addClass("current_slide").fadeIn(u.transition_time,function(){e(".image_wrapper:not(.current_slide)",p).hide()})):a<e(".current_slide",p).index()&&(e(".current_slide",p).removeClass("current_slide").fadeOut(u.transition_time),e(".image_wrapper",p).eq(a).addClass("current_slide").show()):(e(".current_slide",p).removeClass("current_slide").fadeOut(u.transition_time),e(".image_wrapper",p).eq(a).addClass("current_slide").fadeIn(u.transition_time)),i(),l(),_(),u.onChange()}function l(){"none"!=u.caption?e(".square1_caption",p).fadeOut(u.transition_time,function(){setTimeout(function(){e(".square1_caption",p).html(e(".current_slide img",p).attr("alt")).fadeIn(u.transition_time-200)},10)}):e(".square1_caption",p).remove()}function _(){"none"!=u.dots_nav?(e(".square1_dots span",p).removeClass("current"),e('.square1_dots span[data-image-num="'+e(".current_slide",p).index()+'"]',p).addClass("current")):e(".square1_dots",p).remove()}var c,p=this;if(!(p.length<1)){if(e(p).data("settings")){var u=e(p).data("settings");c=e(p).data("interval")}else{u=e.extend({width:"",height:"",fill_mode:"cover",scale_from:"center center",background:"none",auto_start:!0,start_delay:0,slide_duration:4e3,transition_time:500,pause_on_hover:!1,keyboard:!0,gestures:!0,lazy_load:!1,theme:"dark",prev_next_nav:"inside",dots_nav:"inside",caption:"outside",onLoad:function(){},onPlay:function(){},onStop:function(){},onChange:function(){}},a);e(p).data("settings",u)}if("play"!=a){if("stop"==a)return u.auto_start=!1,void s();if("next"==a)return n(),void(u.auto_start&&i());if("prev"==a)return o(),void(u.auto_start&&i());if(Math.floor(a)===a&&+a===a)return d(a-1),void(u.auto_start&&i());e(p).css({position:"relative",width:u.width,height:u.height,background:u.background}),p.addClass("square1 loading"),u.keyboard&&!p.attr("tabindex")&&p.attr("tabindex",0),p.wrapInner('<div class="slides_container" />'),p.find(".slides_container").children().wrap('<div class="image_wrapper" />'),t(e(".image_wrapper:first-child",p)),e(".image_wrapper:first",p).addClass("current_slide"),e(".image_wrapper:not(.current_slide)",p).hide(),e(p).append('<div class="square1_caption"></div>'),e(p).find(".image_wrapper").length>1&&e(p).append('<div class="square1_controls"><span class="square1_prev_image">Previous Image</span><span class="square1_next_image">Next Image</span><div class="square1_dots"></div></div>'),e(p).append('<div class="square1_spinner"></div>');var m,g,f,v,h=0;if(e(".image_wrapper",p).each(function(){e(".square1_dots",p).append('<span data-image-num="'+h+'"></span>'),h++}),e(".square1_dots span:first-child",p).addClass("current"),"slide"==u.animation){p.addClass("slide_animation"),e(".image_wrapper, .wrap_placeholder",p).show();h=0;e(".image_wrapper, .wrap_placeholder",p).each(function(){e(this).css({left:100*h+"%",transitionDuration:u.transition_time+"ms"}),h++}),e(".image_wrapper",p).last().clone().removeClass("image_wrapper").addClass("wrap_placeholder").css({left:"-100%"}).appendTo(e(".slides_container",p)),e(".image_wrapper",p).first().clone().removeClass("image_wrapper").addClass("wrap_placeholder").css({left:100*e(".image_wrapper",p).length+"%"}).appendTo(e(".slides_container",p))}if(e(p).addClass("fill_mode-"+u.fill_mode),e(p).addClass("theme-"+u.theme),e(p).addClass("prev_next_nav-"+u.prev_next_nav),e(p).addClass("dots_nav-"+u.dots_nav),e(p).addClass("caption-"+u.caption),e(".square1_prev_image",p).click(function(){o()}),e(".square1_next_image",p).click(function(){n()}),e(".square1_dots span",p).click(function(){d(e(this).data("image-num"))}),e(p).keydown(function(e){if(37==e.keyCode||38==e.keyCode)o();else{if(39!=e.keyCode&&40!=e.keyCode)return;n()}e.preventDefault(),e.stopPropagation()}),u.gestures)e(p).on("touchstart",function(e){m=e.touches[0].screenX,g=e.touches[0].screenY,f=new Date}),e(p).on("touchmove",function(e){v=e}),e(p).on("touchend",function(e){deltaX=v.touches[0].screenX-m,deltaY=v.touches[0].screenY-g,touchDuration=new Date-f,Math.abs(deltaX/deltaY)<2||Math.abs(deltaX)<30||touchDuration>800||(deltaX>0?o():n())});e(p).on("mouseenter",".image_wrapper",function(){u.pause_on_hover&&s()}),e(p).on("mouseleave",".image_wrapper",function(){u.pause_on_hover&&u.auto_start&&r()}),u.auto_start&&setTimeout(r,u.start_delay),l();var w,C=0;return p}r()}}})(jQuery);